---
id: "seedpool-history"
name: "seedpool (history)"
description: "seedpool user's torrent history plus site-wide user data"
language: "en-US"
type: "private"
encoding: "UTF-8"
links:
  - "https://seedpool.org/"

caps:

  categorymappings:
    # TODO: Canonicalize these categories as much as possible into the various
    # "standards", conventions, and tools involved:
    # - `901###` = "User/*"
    # - `9011##` = "User/Site-*"
    # - `9014##` = "User/History-*"
    # - `9017##` = "User/Moderation-*"
    - {id: 901000, cat: "Other/Misc", desc: "User"}
    - {id: 901100, cat: "Other/Misc", desc: "User/Site"}
    - {id: 901400, cat: "Other/Misc", desc: "User/History"}
    - {id: 901410, cat: "Other/Misc", desc: "User/History-Unsatisfieds"}
    - {id: 901420, cat: "Other/Misc", desc: "User/History-Active"}
    - {id: 901430, cat: "Other/Misc", desc: "User/History-Completed"}
    - {id: 901440, cat: "Other/Misc", desc: "User/History-Prewarned"}
    - {id: 901450, cat: "Other/Misc", desc: "User/History-HnR"}
    - {id: 901460, cat: "Other/Misc", desc: "User/History-Immune"}
    - {id: 901470, cat: "Other/Misc", desc: "User/History-Uploaded"}
    - {id: 901480, cat: "Other/Misc", desc: "User/History-Downloaded"}
    - {id: 901700, cat: "Other/Misc", desc: "User/Moderation"}
    - {id: 901710, cat: "Other/Misc", desc: "User/Moderation-Pending"}
    - {id: 901720, cat: "Other/Misc", desc: "User/Moderation-Approved"}
    - {id: 901730, cat: "Other/Misc", desc: "User/Moderation-Rejected"}
    - {id: 901740, cat: "Other/Misc", desc: "User/Moderation-Postponed"}

  modes:
    search: ["q"]
    tv-search: ["q"]
    movie-search: ["q"]
    music-search: ["q"]

settings:
  - name: "username"
    type: "text"
    label: "Username"
  - name: "password"
    type: "password"
    label: "Password"
  - name: "filters"
    label: "Filter user history on current torrent status"
    type: "multi-select"
    defaults:
      - "Unsatisfieds"
    options:
      unsatisfied: "Unsatisfieds"
      active: "Active"
      completed: "Completed"
      prewarn: "Prewarned?"
      hitrun: "H&R?"
      immune: "Immune?"
      uploaded: "Uploaded"
      downloaded: "Downloaded"
  - name: "statuses"
    label: "Filter user history on moderation status"
    type: "multi-select"
    defaults: []
    options:
      0: "Pending"
      1: "Approved"
      2: "Rejected"
      3: "Postponed"
  - name: "sortField"
    type: "select"
    label: "Sort on the selected fields"
    default: "seedtime"
    options:
      name: "Name"
      seeders: "Seeders"
      leechers: "Leechers"
      times_completed: "Completed"
      agent: "Client"
      size: "Size"
      actual_uploaded: "Upload"
      actual_downloaded: "Download"
      actual_ratio: "Ratio"
      leechtime: "Leeched"
      seedtime: "Seeded"
      created_at: "Started"
      updated_at: "Updated"
      completed_at: "Completed"
      prewarned_at: "Prewarned?"
      seeding: "Seeding"
      leeching: "Leeching"
      hitrun: "H&R?"
      immune: "Immune?"
      uploaded: "Uploaded"
      status: "Approved"
  - name: "sortDirection"
    type: "select"
    label: "Sort direction"
    default: "asc"
    options:
      desc: "Descending"
      asc: "Ascending"

login:
  # note APIKEY is broken on this 5.3.0 site
  path: "login"
  method: "form"
  form: >-
    form[action$="/login"]
  selectors: true
  inputs:
    'input[id="username"]': >-
      {{ .Config.username }}
    'input[id="password"]': >-
      {{ .Config.password }}
    'input[name="remember"]': "on"
    'input[id="_username"]': ""
    # TODO: Can't find a way to have a dynamic `name="..."` *and* dynamic `value="..."`:
    'input[type="hidden"]:not([id="_token"], [id="_captcha"])': "0"
  selectorinputs:
    _token:
      selector: >-
        input[name="_token"]
      attribute: "value"
    _captcha:
      selector: >-
        input[name="_captcha"]
      attribute: "value"
  error:
    - selector: >-
        .auth-form__errors
  test:
    path: >-
      /users/{{ .Config.username }}/torrents?showMorePrecision=true
    selector: >-
      form[action*="/logout"]

search:
  paths:
    - path: >-
        /users/{{ .Config.username }}/torrents
      inputs:
        showMorePrecision: "true"
  inputs:
    $raw: >-
      {{ range .Categories }}categories[]={{.}}&{{end}}
    # for dashboard imdbid search
    search: >-
      {{ .Keywords }}
    sortField: >-
      {{ .Config.sortField }}
    sortDirection: >-
      {{ .Config.sortDirection }}

  rows:
    # 1. the site-wide user data summary in the header, 1 row
    # 2. the user torrent history rows
    selector: >-
      nav.top-nav div.top-nav__right,
      tr[x-data="userHistory"]

  fields:
    category:
      text: >-
        {{ if .Query.Categories }}
          {{ .Query.Categories[0] }}
        {{ else }}
          {{ if .Config.filters }}
            {{ .Config.filters[0] }}
          {{ else }}
            {{ if .Config.statuses }}{{ .Config.statuses[0] }}{{ end }}
          {{ end }}
        {{ end }}"
    title:
      selector: >-
        .user-torrents__name
    details:
      selector: >-
        a.user-torrents__name
      attribute: "href"
    download:
      text: >-
        {{
          re_replace
          .Result.details
          "https://seedpool\.org/torrents/"
          "https://seedpool.org/torrents/download/"
        }}
    seeders:
      selector: >-
        .user-torrents__seeders
    leechers:
      selector: >-
        .user-torrents__leechers
    grabs:
      selector: >-
        .user-torrents__times
    agent:
      selector: >-
        .user-torrents__agent
    size:
      selector: >-
        .user-torrents__size
    uploadactual:
      selector: >-
        .user-torrents__upload span:nth-child(1)
    uploadcredited:
      selector: >-
        .user-torrents__upload span:nth-child(2)
    downloadactual:
      selector: >-
        .user-torrents__download span:nth-child(1)
    downloadcredited:
      selector: >-
        .user-torrents__download span:nth-child(2)
    ratioactual:
      selector: >-
        .user-torrents__ratio span:nth-child(1)
    ratiocredited:
      selector: >-
        .user-torrents__ratio span:nth-child(2)
    leechtime:
      selector: >-
        .user-torrents__leechtime
    seedtime:
      selector: >-
        .user-torrents__seedtime
    createdat:
      selector: >-
        .user-torrents__created-at
    date:
      text: >-
        {{ .Result.createdat }}
    updatedat:
      selector: >-
        .user-torrents__updated-at
    completedat:
      selector: >-
        .user-torrents__completed-at
    prewarnedat:
      selector: >-
        .user-torrents__prewarned-at
    seeding:
      selector: >-
        .user-torrents__seeding [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    leeching:
      selector: >-
        .user-torrents__leeching [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    warned:
      selector: >-
        .user-torrents__warned [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    immune:
      selector: >-
        .user-torrents__immune [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    uploader:
      selector: >-
        .user-torrents__uploader [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    status:
      selector: >-
        .user-torrents__status [title]
      attribute: "title"
      case:
        "Not *": "false"
        "*": "true"
    # description:
    #   text: |
    #     TODO: JSON for unsupported fields?
    downloadvolumefactor:
      text: "1"
    uploadvolumefactor:
      text: "1"
# global MR is 1.0 but torrents must be seeded for 10 days regardless of ratio
#    minimumratio:
#      text: 1.0
    minimumseedtime:
      # 10 days (as seconds = 10 x 24 x 60 x 60)
      text: 864000
# json UNIT3D 8.3.6 (custom)
